{"version":3,"file":"three-freeform-controls.umd.js","sources":["../src/utils/constants.ts","../src/primitives/cone.ts","../src/primitives/line.ts","../src/controls/handles/index.ts","../src/controls/handles/translation.ts","../src/primitives/octahedron.ts","../src/controls/handles/rotation.ts","../src/controls/handles/pick.ts","../src/primitives/plane.ts","../src/controls/handles/pick-plane.ts","../src/controls/handles/rotation-eye.ts","../src/controls/index.ts","../node_modules/nanoevents/index.js","../node_modules/nanoevents/unbind-all.js","../src/utils/emmiter.ts","../src/utils/helper.ts","../src/utils/raycaster.ts","../src/controls-manager.ts"],"sourcesContent":["export const DEFAULT_LINE_HEIGHT = 1;\nexport const DEFAULT_RADIAL_SEGMENTS = 32;\n\nexport const DEFAULT_CONE_HEIGHT = 0.75;\nexport const DEFAULT_CONE_RADIUS = 0.3;\n\nexport const DEFAULT_OCTAHEDRON_RADIUS = 0.1;\n\nexport const DEFAULT_PLANE_WIDTH = 0.75;\nexport const DEFAULT_PLANE_HEIGHT = 0.75;\nexport const DEFAULT_PLANE_SEGMENTS = 32;\n\nexport const DEFAULT_RING_NUM_POINTS = 64;\nexport const DEFAULT_RING_RADIUS = 1;\n\nexport enum PICK_PLANE_OPACITY {\n  ACTIVE = 0.75,\n  INACTIVE = 0.3\n}\n\nexport const DEFAULT_CONTROLS_SEPARATION = 1;\nexport const DEFAULT_ROTATION_RADIUS_SCALE = 1;\nexport const DEFAULT_EYE_ROTATION_SCALE = 1.25;\nexport const DEFAULT_PLANE_SIZE_SCALE = 0.75;\nexport const DEFAULT_TRANSLATION_DISTANCE_SCALE = 1;\n\nexport const DEFAULT_COLOR_ARROW = \"#f0ff00\";\nexport const DEFAULT_COLOR_RING = \"#f0ff00\";\nexport const DEFAULT_COLOR_PLANE = \"#f0ff00\";\nexport const DEFAULT_CONTROLS_OPACITY = 1;\n","import * as THREE from \"three\";\nimport {\n  DEFAULT_CONE_HEIGHT,\n  DEFAULT_CONE_RADIUS,\n  DEFAULT_CONTROLS_OPACITY,\n  DEFAULT_RADIAL_SEGMENTS\n} from \"../utils/constants\";\n\nexport default class Cone extends THREE.Mesh {\n  constructor(color: string) {\n    super();\n    this.geometry = new THREE.ConeGeometry(\n      DEFAULT_CONE_RADIUS,\n      DEFAULT_CONE_HEIGHT,\n      DEFAULT_RADIAL_SEGMENTS\n    );\n    this.material = new THREE.MeshBasicMaterial({ color, depthTest: false });\n    this.material.transparent = true;\n    this.material.opacity = DEFAULT_CONTROLS_OPACITY;\n  }\n}\n","import * as THREE from \"three\";\nimport { DEFAULT_CONTROLS_OPACITY } from \"../utils/constants\";\n\nexport default class Line extends THREE.LineLoop {\n  constructor(color: string, geometry: THREE.Geometry) {\n    super();\n    this.geometry = geometry;\n    this.material = new THREE.MeshBasicMaterial({ color, depthTest: true });\n    this.material.transparent = true;\n    this.material.opacity = DEFAULT_CONTROLS_OPACITY;\n  }\n}\n","import * as THREE from \"three\";\n\n/**\n * Names for default handles\n */\nexport enum DEFAULT_HANDLE_GROUP_NAME {\n  /**\n   * name for default translation handle along the +ve x-axis\n   */\n  XPT = \"xpt_handle\",\n  /**\n   * name for default translation handle along the +ve y-axis\n   */\n  YPT = \"ypt_handle\",\n  /**\n   * name for default translation handle along the +ve z-axis\n   */\n  ZPT = \"zpt_handle\",\n  /**\n   * name for default translation handle along the -ve x-axis\n   */\n  XNT = \"xnt_handle\",\n  /**\n   * name for default translation handle along the -ve y-axis\n   */\n  YNT = \"ynt_handle\",\n  /**\n   * name for default translation handle along the -ve z-axis\n   */\n  ZNT = \"znt_handle\",\n  /**\n   * name for default rotation handle along the x-axis\n   */\n  XR = \"xr_handle\",\n  /**\n   * name for default rotation handle along the y-axis\n   */\n  YR = \"yr_handle\",\n  /**\n   * name for default rotation handle along the z-axis\n   */\n  ZR = \"zr_handle\",\n  /**\n   * name for default rotation handle in the eye-plane\n   */\n  ER = \"er_handle\",\n  /**\n   * name for default translation handle in the eye-plane\n   */\n  PICK = \"pick_handle\",\n  /**\n   * name for default translation handle in the xy plane\n   */\n  PICK_PLANE_XY = \"pick_plane_xy_handle\",\n  /**\n   * name for default translation handle in the yz plane\n   */\n  PICK_PLANE_YZ = \"pick_plane_yz_handle\",\n  /**\n   * name for default translation handle in the zx plane\n   */\n  PICK_PLANE_ZX = \"pick_plane_zx_handle\"\n}\n\n/**\n * Base class for all handles\n * @noInheritDoc\n */\nexport abstract class HandleGroup extends THREE.Group {\n  /**\n   * returns an array of all the interactive objects that form a handle;\n   * note that a handle can have non-interactive objects as well.\n   */\n  public abstract getInteractiveObjects(): THREE.Mesh[];\n\n  /**\n   * sets the color for the handle; this may involve setting colors for multiple\n   * constituent meshes that form the handle (interactive or non-interactive)\n   * @param color - hex code for the color\n   */\n  public abstract setColor(color: string): void;\n}\n\n/**\n * This class can be extended to create custom translation handles.\n * It requires setting the properties `parallel` and `up`.\n */\nexport abstract class TranslationGroup extends HandleGroup {\n  /**\n   * This is a unit vector that runs parallel to the direction of the translation handle.\n   * For example, in case of [[Controls.translationXP]], it is\n   * `THREE.Vector3(1,0,0)` (along the x-axis).\n   */\n  public abstract parallel: THREE.Vector3;\n  /**\n   * This is a unit vector that runs perpendicular to the direction of the translation handles.\n   * For example, in case of [[Controls.translationXP]], it is\n   * `THREE.Vector3(0,1,0)` (along the y-axis).\n   */\n  public up = new THREE.Vector3();\n}\n\n/**\n * This class can be extended to create custom rotation handles.\n * It requires setting the property `up`.\n */\nexport abstract class RotationGroup extends HandleGroup {\n  /**\n   * This is a unit vector that runs along the axis of the rotation handles.\n   * For example, in case of [[Controls.rotationX]], it is\n   * `THREE.Vector3(1,0,0)` (along the x-axis).\n   */\n  public up = new THREE.Vector3();\n}\n\n/**\n * This class can be extended to create custom pick handle (translates in eye-plane).\n */\nexport abstract class PickGroup extends HandleGroup {}\n\n/**\n * This class can be extended to create custom pick plane handles.\n * It requires setting the property `up`.\n */\nexport abstract class PickPlaneGroup extends HandleGroup {\n  /**\n   * This is a unit vector that is perpendicular to the plane handles.\n   * For example, in case of [[Controls.pickPlaneXY]], it is\n   * `THREE.Vector3(0,0,1)` (along the z-axis).\n   */\n  public up = new THREE.Vector3();\n}\n\nexport type IHandle = RotationGroup | TranslationGroup | PickGroup | PickPlaneGroup;\n","import * as THREE from \"three\";\nimport Cone from \"../../primitives/cone\";\nimport {\n  DEFAULT_COLOR_ARROW,\n  DEFAULT_CONE_HEIGHT,\n  DEFAULT_CONE_RADIUS,\n  DEFAULT_LINE_HEIGHT\n} from \"../../utils/constants\";\nimport Line from \"../../primitives/line\";\nimport { TranslationGroup } from \"./index\";\n\nexport default class Translation extends TranslationGroup {\n  private readonly cone: Cone;\n  private readonly line: Line;\n  public parallel = new THREE.Vector3(0, 1, 0);\n\n  constructor(color = DEFAULT_COLOR_ARROW) {\n    super();\n    this.cone = new Cone(color);\n    const lineGeometry = new THREE.Geometry();\n    lineGeometry.vertices.push(new THREE.Vector3(0, 0, 0));\n    lineGeometry.vertices.push(new THREE.Vector3(0, DEFAULT_LINE_HEIGHT, 0));\n\n    this.line = new Line(color, lineGeometry);\n    this.cone.geometry.scale(DEFAULT_CONE_RADIUS, DEFAULT_CONE_HEIGHT, DEFAULT_CONE_RADIUS);\n    this.cone.translateY(DEFAULT_LINE_HEIGHT);\n\n    this.add(this.cone);\n    this.add(this.line);\n  }\n\n  /**\n   * @hidden\n   */\n  public getInteractiveObjects = () => {\n    return [this.cone];\n  };\n\n  public setColor = (color: string) => {\n    const coneMaterial = this.cone.material as THREE.MeshBasicMaterial;\n    const lineMaterial = this.line.material as THREE.MeshBasicMaterial;\n    coneMaterial.color.set(color);\n    lineMaterial.color.set(color);\n  };\n}\n","import * as THREE from \"three\";\nimport { DEFAULT_OCTAHEDRON_RADIUS } from \"../utils/constants\";\n\nexport default class Octahedron extends THREE.Mesh {\n  constructor(color: string) {\n    super();\n    this.geometry = new THREE.OctahedronBufferGeometry(DEFAULT_OCTAHEDRON_RADIUS, 0);\n    this.material = new THREE.MeshBasicMaterial({\n      color,\n      depthTest: false,\n      transparent: true,\n      side: THREE.DoubleSide\n    });\n  }\n}\n","import * as THREE from \"three\";\nimport {\n  DEFAULT_COLOR_RING,\n  DEFAULT_RING_NUM_POINTS,\n  DEFAULT_RING_RADIUS\n} from \"../../utils/constants\";\nimport Line from \"../../primitives/line\";\nimport Octahedron from \"../../primitives/octahedron\";\nimport { RotationGroup } from \"./index\";\n\nexport default class Rotation extends RotationGroup {\n  private readonly ring: Line;\n  private readonly handlebar: Octahedron;\n\n  constructor(color = DEFAULT_COLOR_RING, ringRadius = DEFAULT_RING_RADIUS) {\n    super();\n    const ringNumberOfPoints = DEFAULT_RING_NUM_POINTS;\n    const ringGeometry = new THREE.Geometry();\n    const angle = (2 * Math.PI) / ringNumberOfPoints;\n    for (let i = 1; i < ringNumberOfPoints + 1; i++) {\n      ringGeometry.vertices.push(\n        new THREE.Vector3(ringRadius * Math.cos(i * angle), ringRadius * Math.sin(i * angle), 0)\n      );\n    }\n    this.ring = new Line(color, ringGeometry);\n    this.handlebar = new Octahedron(color);\n    this.handlebar.position.y = ringRadius;\n    this.add(this.ring);\n    this.add(this.handlebar);\n  }\n\n  /**\n   * @hidden\n   */\n  public getInteractiveObjects = () => {\n    return [this.handlebar];\n  };\n\n  public setColor = (color: string) => {\n    const ringMaterial = this.ring.material as THREE.MeshBasicMaterial;\n    const handlebarMaterial = this.handlebar.material as THREE.MeshBasicMaterial;\n    ringMaterial.color.set(color);\n    handlebarMaterial.color.set(color);\n  };\n}\n","import * as THREE from \"three\";\nimport Octahedron from \"../../primitives/octahedron\";\nimport { PickGroup } from \"./index\";\n\nexport default class Pick extends PickGroup {\n  private readonly octahedron: Octahedron;\n\n  constructor() {\n    super();\n    this.octahedron = new Octahedron(\"white\");\n    this.add(this.octahedron);\n  }\n\n  /**\n   * @hidden\n   */\n  public getInteractiveObjects = () => {\n    return [this.octahedron];\n  };\n\n  public setColor = (color: string) => {\n    const octahedronMaterial = this.octahedron.material as THREE.MeshBasicMaterial;\n    octahedronMaterial.color.set(color);\n  };\n}\n","import * as THREE from \"three\";\nimport {\n  DEFAULT_COLOR_RING,\n  DEFAULT_PLANE_HEIGHT,\n  DEFAULT_PLANE_SEGMENTS,\n  DEFAULT_PLANE_WIDTH,\n  PICK_PLANE_OPACITY\n} from \"../utils/constants\";\n\nexport default class Plane extends THREE.Mesh {\n  constructor(\n    color = DEFAULT_COLOR_RING,\n    width = DEFAULT_PLANE_WIDTH,\n    height = DEFAULT_PLANE_HEIGHT\n  ) {\n    super();\n    this.geometry = new THREE.PlaneGeometry(width, height, DEFAULT_PLANE_SEGMENTS);\n    this.material = new THREE.MeshBasicMaterial({\n      color,\n      depthTest: false,\n      side: THREE.DoubleSide,\n      transparent: true\n    });\n    this.material.opacity = PICK_PLANE_OPACITY.INACTIVE;\n  }\n}\n","import * as THREE from \"three\";\nimport Plane from \"../../primitives/plane\";\nimport {\n  DEFAULT_COLOR_PLANE,\n  DEFAULT_PLANE_HEIGHT,\n  DEFAULT_PLANE_WIDTH\n} from \"../../utils/constants\";\nimport Line from \"../../primitives/line\";\nimport { PickPlaneGroup } from \"./index\";\n\nexport default class PickPlane extends PickPlaneGroup {\n  /**\n   * @hidden\n   */\n  public readonly plane: Plane;\n  /**\n   * @hidden\n   */\n  public readonly boundary: Line;\n  /**\n   * @hidden\n   */\n  public readonly crossX: Line;\n  /**\n   * @hidden\n   */\n  public readonly crossY: Line;\n\n  constructor(\n    color = DEFAULT_COLOR_PLANE,\n    width = DEFAULT_PLANE_WIDTH,\n    height = DEFAULT_PLANE_HEIGHT\n  ) {\n    super();\n    const boundaryGeometry = new THREE.Geometry();\n    const crossXGeometry = new THREE.Geometry();\n    const crossYGeometry = new THREE.Geometry();\n\n    const vertexMaxX = width / 2;\n    const vertexMaxY = height / 2;\n\n    boundaryGeometry.vertices.push(new THREE.Vector3(vertexMaxX, vertexMaxY, 0));\n    boundaryGeometry.vertices.push(new THREE.Vector3(vertexMaxX, -vertexMaxY, 0));\n    boundaryGeometry.vertices.push(new THREE.Vector3(-vertexMaxX, -vertexMaxY, 0));\n    boundaryGeometry.vertices.push(new THREE.Vector3(-vertexMaxX, vertexMaxY, 0));\n\n    crossXGeometry.vertices.push(new THREE.Vector3(0, vertexMaxY, 0));\n    crossXGeometry.vertices.push(new THREE.Vector3(0, -vertexMaxY, 0));\n\n    crossYGeometry.vertices.push(new THREE.Vector3(-vertexMaxX, 0, 0));\n    crossYGeometry.vertices.push(new THREE.Vector3(vertexMaxX, 0, 0));\n\n    this.boundary = new Line(color, boundaryGeometry);\n    this.crossX = new Line(\"black\", crossXGeometry);\n    this.crossY = new Line(\"black\", crossYGeometry);\n    this.plane = new Plane(color, width, height);\n\n    this.add(this.plane);\n    this.add(this.boundary);\n    this.add(this.crossX);\n    this.add(this.crossY);\n  }\n\n  /**\n   * @hidden\n   */\n  public getInteractiveObjects = () => {\n    return [this.plane];\n  };\n\n  public setColor = (color: string) => {\n    const planeMaterial = this.plane.material as THREE.MeshBasicMaterial;\n    const boundaryMaterial = this.boundary.material as THREE.MeshBasicMaterial;\n    planeMaterial.color.set(color);\n    boundaryMaterial.color.set(color);\n  };\n}\n","import * as THREE from \"three\";\nimport Rotation from \"./rotation\";\nimport { DEFAULT_COLOR_RING, DEFAULT_RING_RADIUS } from \"../../utils/constants\";\n\n/**\n * @hidden\n */\nexport default class RotationEye extends Rotation {\n  public camera: THREE.Camera | null = null;\n  private controlsWorldOrientation = new THREE.Quaternion();\n  private _temp1 = new THREE.Vector3();\n  private _temp2 = new THREE.Vector3();\n  private _temp3 = new THREE.Quaternion();\n  private worldPosition = new THREE.Vector3();\n\n  constructor(color = DEFAULT_COLOR_RING, radius = DEFAULT_RING_RADIUS) {\n    super(color, radius);\n  }\n\n  updateMatrixWorld(force?: boolean): void {\n    if (this.camera !== null) {\n      this.parent?.matrixWorld.decompose(this._temp1, this.controlsWorldOrientation, this._temp2);\n      this.matrixWorld.decompose(this.worldPosition, this._temp3, this._temp2);\n      this.camera\n        .getWorldQuaternion(this.quaternion)\n        .premultiply(this.controlsWorldOrientation.inverse());\n      this.camera.getWorldPosition(this.up).sub(this.worldPosition);\n    }\n    super.updateMatrixWorld(force);\n  }\n}\n","import * as THREE from \"three\";\nimport {\n  DEFAULT_CONTROLS_SEPARATION,\n  DEFAULT_EYE_ROTATION_SCALE,\n  DEFAULT_PLANE_SIZE_SCALE,\n  DEFAULT_ROTATION_RADIUS_SCALE,\n  DEFAULT_TRANSLATION_DISTANCE_SCALE\n} from \"../utils/constants\";\nimport Translation from \"./handles/translation\";\nimport Rotation from \"./handles/rotation\";\nimport Pick from \"./handles/pick\";\nimport PickPlane from \"./handles/pick-plane\";\nimport {\n  DEFAULT_HANDLE_GROUP_NAME,\n  IHandle,\n  PickGroup,\n  PickPlaneGroup,\n  RotationGroup,\n  TranslationGroup\n} from \"./handles\";\nimport RotationEye from \"./handles/rotation-eye\";\n\nexport enum ANCHOR_MODE {\n  /**\n   * In this mode the Controls do not inherit the orientation of the object\n   * as it is rotated.\n   */\n  FIXED = \"fixed\",\n  /**\n   * In this mode the Controls rotate as the object is rotated.\n   */\n  INHERIT = \"inherit\"\n}\n\n/**\n * The first number is the unit limit allowed in the -ve direction.\n * The second number is the unit limit allowed in the +ve direction.\n *\n * All calculations are with respect to anchor position which is the object's\n * position when [[setTranslationLimit]] is called.\n * `{ x: [-1, 2], y: false, z: false }` - sets the translation limit to `-1` unit\n * in the -x-direction, `+2` units in the +x-direction, and no limit on the\n * y and z-direction.\n *\n * Setting the limit to `false` disables the limit in all directions.\n */\nexport interface TranslationLimit {\n  x: [number, number] | false;\n  y: [number, number] | false;\n  z: [number, number] | false;\n}\n\nexport interface IControlsOptions {\n  /**\n   * the anchor mode for the controls\n   * @default [[ANCHOR_MODE.FIXED]]\n   */\n  mode?: ANCHOR_MODE;\n  /**\n   * distance between the position of the object and the position of the\n   * handles (in case of translation handles), or the radius (in case of rotation handles),\n   * or the size of the plane (in case of plane handles)\n   * @default 0.5\n   */\n  separation?: number;\n  /**\n   * uses THREE.Mesh.computeBounds to set the separation; if separation\n   * is provided in addition to this option, it is added to the computed bounds\n   * @default false\n   */\n  useComputedBounds?: boolean;\n  /**\n   * the quaternion applied to the whole Controls instance (handles get rotated relatively)\n   * @default undefined\n   */\n  orientation?: {\n    x: number;\n    y: number;\n    z: number;\n    w: number;\n  };\n  /**\n   * hides other handles of a Controls instance when drag starts\n   * @default true\n   */\n  hideOtherHandlesOnDrag?: boolean;\n  /**\n   *  hides all other Controls instances when drag starts\n   *  @default true\n   */\n  hideOtherControlsInstancesOnDrag?: boolean;\n  /**\n   * displays the plane in which the drag interaction takes place\n   * (useful for debugging)\n   * @default false\n   */\n  showHelperPlane?: boolean;\n  /**\n   * enables damping for the controls\n   * @default true\n   */\n  isDampingEnabled?: boolean;\n  /**\n   * sets the scaling factor for the radius of rotation handles\n   * @default 1.0\n   */\n  rotationRadiusScale?: number;\n  /**\n   * sets the scaling factor for the radius of rotation handles in eye plane\n   * @default 1.25\n   */\n  eyeRotationRadiusScale?: number;\n  /**\n   * sets the width and height scale for the pick plane handles\n   * @default 0.75\n   */\n  pickPlaneSizeScale?: number;\n  /**\n   * sets the scaling for distance between translation handles' start and the\n   * center of the controls\n   * @default 1.0\n   */\n  translationDistanceScale?: number;\n  /**\n   * For translation handles: highlights the axis along which the object moves.\n   * For rotation handles: highlights the axis of rotation.\n   * Not available on other handles.\n   * @default true\n   */\n  highlightAxis?: boolean;\n  /**\n   * Enables snap to grid (nearest integer coordinate) for all translation type handles:\n   * [[TranslationGroup]], [[PickGroup]], and [[PickPlaneGroup]]\n   * @default { x: false, y: false, z: false }\n   */\n  snapTranslation?: {\n    x: boolean;\n    y: boolean;\n    z: boolean;\n  };\n}\n\n/**\n * Controls is the main class in this library.\n * It is a subclass of THREE.Group, so its properties like `position` and\n * `quaternion` can be modified as desired.\n * The `children` are the control handles (like `rotationX`).\n * All translations and rotations are setup with respect to the global coordinate system.\n * @noInheritDoc\n */\nexport default class Controls extends THREE.Group {\n  /**\n   * handle which translates the object in the eye-plane\n   */\n  public readonly pick: Pick;\n  /**\n   * handle which translates the object in XY plane\n   */\n  public readonly pickPlaneXY: PickPlane;\n  /**\n   * handle which translates the object in YZ plane\n   */\n  public readonly pickPlaneYZ: PickPlane;\n  /**\n   * handle which translates the object in ZX plane\n   */\n  public readonly pickPlaneZX: PickPlane;\n  /**\n   * handle which translates the object along the x-axis; displayed in the\n   * +ve x-axis direction\n   */\n  public readonly translationXP: Translation;\n  /**\n   * handle which translates the object along the y-axis; displayed in the\n   * +ve y-axis direction\n   */\n  public readonly translationYP: Translation;\n  /**\n   * handle which translates the object along the z-axis; displayed in the\n   * +ve z-axis direction\n   */\n  public readonly translationZP: Translation;\n  /**\n   * handle which translates the object along the x-axis; displayed in the\n   * -ve x-axis direction\n   */\n  public readonly translationXN: Translation;\n  /**\n   * handle which translates the object along the y-axis; displayed in the\n   * -ve y-axis direction\n   */\n  public readonly translationYN: Translation;\n  /**\n   * handle which translates the object along the z-axis; displayed in the\n   * -ve z-axis direction\n   */\n  public readonly translationZN: Translation;\n  /**\n   * handle which rotates the object along the x-axis\n   */\n  public readonly rotationX: Rotation;\n  /**\n   * handle which rotates the object along the y-axis\n   */\n  public readonly rotationY: Rotation;\n  /**\n   * handle which rotates the object along the z-axis\n   */\n  public readonly rotationZ: Rotation;\n  /**\n   * handle which rotates the object in the eye-plane\n   */\n  public readonly rotationEye: RotationEye;\n  private handleTargetQuaternion = new THREE.Quaternion();\n  private objectWorldPosition = new THREE.Vector3();\n  private objectTargetPosition = new THREE.Vector3();\n  private objectTargetQuaternion = new THREE.Quaternion();\n  private objectParentWorldPosition = new THREE.Vector3();\n  private objectParentWorldQuaternion = new THREE.Quaternion();\n  private objectParentWorldScale = new THREE.Vector3();\n  private deltaPosition = new THREE.Vector3();\n  private normalizedHandleParallelVectorCache = new THREE.Vector3();\n  private touch1 = new THREE.Vector3();\n  private touch2 = new THREE.Vector3();\n  private boundingSphereRadius = 0;\n  private dragStartPoint = new THREE.Vector3();\n  private dragIncrementalStartPoint = new THREE.Vector3();\n  private handles: Set<IHandle> = new Set();\n  private isBeingDraggedTranslation = false;\n  private isBeingDraggedRotation = false;\n  private dampingFactor = 0.8;\n  private readonly useComputedBounds: boolean;\n  private readonly separation: number;\n  private initialSelfQuaternion = new THREE.Quaternion();\n  private readonly minTranslationCache = new THREE.Vector3();\n  private readonly maxTranslationCache = new THREE.Vector3();\n  private readonly options: IControlsOptions;\n  private readonly mode: ANCHOR_MODE;\n  private readonly translationDistanceScale: number;\n  private readonly rotationRadiusScale: number;\n  private readonly eyeRotationRadiusScale: number;\n  private readonly pickPlaneSizeScale: number;\n  private translationLimit?: TranslationLimit | false = false;\n  private translationAnchor: THREE.Vector3 | null = null;\n\n  /**\n   * enables damping for the controls\n   * @default true\n   */\n  public isDampingEnabled: boolean;\n  /**\n   * hides other handles of a Controls instance when drag starts\n   * @default true\n   */\n  public hideOtherHandlesOnDrag: boolean;\n  /**\n   *  hides all other Controls instances when drag starts\n   *  @default true\n   */\n  public hideOtherControlsInstancesOnDrag: boolean;\n  /**\n   * displays the plane in which the drag interaction takes place\n   * (useful for debugging)\n   * @default false\n   */\n  public showHelperPlane: boolean;\n  /**\n   * For translation handles: highlights the axis along which the object moves.\n   * For rotation handles: highlights the axis of rotation.\n   * Not available on other handles.\n   * @default true\n   */\n  public highlightAxis: boolean;\n  /**\n   * Enables snap to grid (nearest integer coordinate) for all translation type handles:\n   * [[TranslationGroup]], [[PickGroup]], and [[PickPlaneGroup]]\n   * @default { x: false, y: false, z: false }\n   */\n  public snapTranslation: {\n    x: boolean;\n    y: boolean;\n    z: boolean;\n  };\n\n  /**\n   *\n   * @param object - the object provided by the user\n   * @param camera - the THREE.Camera instance used in the scene\n   * @param options\n   */\n  constructor(\n    public object: THREE.Object3D,\n    private camera: THREE.Camera,\n    options?: IControlsOptions\n  ) {\n    super();\n\n    this.options = options || {};\n    this.mode = this.options?.mode ?? ANCHOR_MODE.FIXED;\n    this.hideOtherHandlesOnDrag = this.options?.hideOtherHandlesOnDrag ?? true;\n    this.hideOtherControlsInstancesOnDrag = this.options?.hideOtherControlsInstancesOnDrag ?? true;\n    this.showHelperPlane = this.options?.showHelperPlane ?? false;\n    this.highlightAxis = this.options?.highlightAxis ?? true;\n    this.useComputedBounds = this.options?.useComputedBounds ?? false;\n    this.snapTranslation = this.options?.snapTranslation ?? {\n      x: false,\n      y: false,\n      z: false\n    };\n    this.separation = this.options?.separation ?? DEFAULT_CONTROLS_SEPARATION;\n    this.isDampingEnabled = this.options?.isDampingEnabled ?? true;\n    this.rotationRadiusScale = this.options?.rotationRadiusScale ?? DEFAULT_ROTATION_RADIUS_SCALE;\n    this.eyeRotationRadiusScale =\n      this.options?.eyeRotationRadiusScale ?? DEFAULT_EYE_ROTATION_SCALE;\n    this.pickPlaneSizeScale = this.options?.pickPlaneSizeScale ?? DEFAULT_PLANE_SIZE_SCALE;\n    this.translationDistanceScale =\n      this.options?.translationDistanceScale ?? DEFAULT_TRANSLATION_DISTANCE_SCALE;\n\n    if (this.options.orientation !== undefined) {\n      const { x, y, z, w } = this.options.orientation;\n      this.initialSelfQuaternion.set(x, y, z, w).normalize();\n      this.quaternion.copy(this.initialSelfQuaternion);\n    }\n\n    this.computeObjectBounds();\n\n    this.pick = new Pick();\n\n    this.pickPlaneXY = new PickPlane(\n      \"yellow\",\n      this.boundingSphereRadius * this.pickPlaneSizeScale,\n      this.boundingSphereRadius * this.pickPlaneSizeScale\n    );\n    this.pickPlaneYZ = new PickPlane(\n      \"cyan\",\n      this.boundingSphereRadius * this.pickPlaneSizeScale,\n      this.boundingSphereRadius * this.pickPlaneSizeScale\n    );\n    this.pickPlaneZX = new PickPlane(\n      \"pink\",\n      this.boundingSphereRadius * this.pickPlaneSizeScale,\n      this.boundingSphereRadius * this.pickPlaneSizeScale\n    );\n\n    this.translationXP = new Translation(\"red\");\n    this.translationYP = new Translation(\"green\");\n    this.translationZP = new Translation(\"blue\");\n\n    this.translationXN = new Translation(\"red\");\n    this.translationYN = new Translation(\"green\");\n    this.translationZN = new Translation(\"blue\");\n\n    this.rotationX = new Rotation(\"red\", this.boundingSphereRadius * this.rotationRadiusScale);\n    this.rotationY = new Rotation(\"green\", this.boundingSphereRadius * this.rotationRadiusScale);\n    this.rotationZ = new Rotation(\"blue\", this.boundingSphereRadius * this.rotationRadiusScale);\n\n    this.rotationEye = new RotationEye(\n      \"yellow\",\n      this.boundingSphereRadius * this.eyeRotationRadiusScale\n    );\n\n    this.setupDefaultTranslation();\n    this.setupDefaultRotation();\n    this.setupDefaultEyeRotation();\n    this.setupDefaultPickPlane();\n    this.setupDefaultPick();\n  }\n\n  private setupDefaultPickPlane = () => {\n    this.pickPlaneXY.name = DEFAULT_HANDLE_GROUP_NAME.PICK_PLANE_XY;\n    this.pickPlaneYZ.name = DEFAULT_HANDLE_GROUP_NAME.PICK_PLANE_YZ;\n    this.pickPlaneZX.name = DEFAULT_HANDLE_GROUP_NAME.PICK_PLANE_ZX;\n\n    this.pickPlaneYZ.up = new THREE.Vector3(1, 0, 0);\n    this.pickPlaneZX.up = new THREE.Vector3(0, 1, 0);\n    this.pickPlaneXY.up = new THREE.Vector3(0, 0, 1);\n\n    this.pickPlaneYZ.rotateY(Math.PI / 2);\n    this.pickPlaneZX.rotateX(Math.PI / 2);\n\n    this.setupHandle(this.pickPlaneXY);\n    this.setupHandle(this.pickPlaneYZ);\n    this.setupHandle(this.pickPlaneZX);\n  };\n\n  public setupHandle = (handle: IHandle) => {\n    this.handles.add(handle);\n    this.add(handle);\n  };\n\n  private setupDefaultPick = () => {\n    this.pick.name = DEFAULT_HANDLE_GROUP_NAME.PICK;\n    this.setupHandle(this.pick);\n  };\n\n  private setupDefaultEyeRotation = () => {\n    this.rotationEye.name = DEFAULT_HANDLE_GROUP_NAME.ER;\n    this.rotationEye.camera = this.camera;\n    this.setupHandle(this.rotationEye);\n  };\n\n  private setupDefaultTranslation = () => {\n    this.translationXP.name = DEFAULT_HANDLE_GROUP_NAME.XPT;\n    this.translationYP.name = DEFAULT_HANDLE_GROUP_NAME.YPT;\n    this.translationZP.name = DEFAULT_HANDLE_GROUP_NAME.ZPT;\n\n    this.translationXN.name = DEFAULT_HANDLE_GROUP_NAME.XNT;\n    this.translationYN.name = DEFAULT_HANDLE_GROUP_NAME.YNT;\n    this.translationZN.name = DEFAULT_HANDLE_GROUP_NAME.ZNT;\n\n    this.translationXP.translateX(this.boundingSphereRadius * this.translationDistanceScale);\n    this.translationYP.translateY(this.boundingSphereRadius * this.translationDistanceScale);\n    this.translationZP.translateZ(this.boundingSphereRadius * this.translationDistanceScale);\n\n    this.translationXN.translateX(-this.boundingSphereRadius * this.translationDistanceScale);\n    this.translationYN.translateY(-this.boundingSphereRadius * this.translationDistanceScale);\n    this.translationZN.translateZ(-this.boundingSphereRadius * this.translationDistanceScale);\n\n    this.translationXP.rotateZ(-Math.PI / 2);\n    this.translationZP.rotateX(Math.PI / 2);\n\n    this.translationXN.rotateZ(Math.PI / 2);\n    this.translationYN.rotateX(Math.PI);\n    this.translationZN.rotateX(-Math.PI / 2);\n\n    this.translationXP.up = new THREE.Vector3(0, 1, 0);\n    this.translationYP.up = new THREE.Vector3(0, 0, 1);\n    this.translationZP.up = new THREE.Vector3(0, 1, 0);\n\n    this.translationXN.up = new THREE.Vector3(0, -1, 0);\n    this.translationYN.up = new THREE.Vector3(0, 0, -1);\n    this.translationZN.up = new THREE.Vector3(0, -1, 0);\n\n    this.translationXP.parallel = new THREE.Vector3(1, 0, 0);\n    this.translationYP.parallel = new THREE.Vector3(0, 1, 0);\n    this.translationZP.parallel = new THREE.Vector3(0, 0, 1);\n\n    this.translationXN.parallel = new THREE.Vector3(-1, 0, 0);\n    this.translationYN.parallel = new THREE.Vector3(0, -1, 0);\n    this.translationZN.parallel = new THREE.Vector3(0, 0, -1);\n\n    this.setupHandle(this.translationXP);\n    this.setupHandle(this.translationYP);\n    this.setupHandle(this.translationZP);\n\n    this.setupHandle(this.translationXN);\n    this.setupHandle(this.translationYN);\n    this.setupHandle(this.translationZN);\n  };\n\n  private setupDefaultRotation = () => {\n    this.rotationX.name = DEFAULT_HANDLE_GROUP_NAME.XR;\n    this.rotationY.name = DEFAULT_HANDLE_GROUP_NAME.YR;\n    this.rotationZ.name = DEFAULT_HANDLE_GROUP_NAME.ZR;\n\n    this.rotationX.up = new THREE.Vector3(1, 0, 0);\n    this.rotationY.up = new THREE.Vector3(0, 1, 0);\n    this.rotationZ.up = new THREE.Vector3(0, 0, 1);\n\n    this.rotationY.rotateX(Math.PI / 2);\n    this.rotationX.rotateY(Math.PI / 2);\n    this.rotationX.rotateZ(Math.PI);\n\n    this.setupHandle(this.rotationX);\n    this.setupHandle(this.rotationY);\n    this.setupHandle(this.rotationZ);\n  };\n\n  private computeObjectBounds = () => {\n    if (this.useComputedBounds) {\n      if (this.object.type === \"Mesh\") {\n        const geometry = (this.object as THREE.Mesh).geometry;\n        geometry.computeBoundingSphere();\n        const {\n          boundingSphere: { radius }\n        } = geometry;\n        this.boundingSphereRadius = radius / 2 + this.separation;\n        return;\n      } else {\n        console.warn(\n          `Bounds can only be computed for object of type THREE.Mesh,\n          received object with type: ${this.object.type}. Falling back to using\n          default separation.\n        `\n        );\n      }\n    }\n    this.boundingSphereRadius = this.separation;\n  };\n\n  /**\n   * Puts a limit on the object's translation anchored at the current position.\n   *\n   * `{ x: [-1, 2], y: false, z: false }` - sets the translation limit to `-1` unit\n   * in the -x-direction, `+2` units in the +x-direction, and no limit on the\n   * y and z-direction.\n   *\n   * Setting the limit to `false` disables the limit in all directions.\n   * @param limit\n   */\n  public setTranslationLimit = (limit: TranslationLimit | false) => {\n    this.translationLimit = limit;\n    this.translationAnchor = limit ? this.position.clone() : null;\n  };\n\n  /**\n   * @hidden\n   */\n  processDragStart = (args: { point: THREE.Vector3; handle: IHandle }) => {\n    const { point, handle } = args;\n    this.dragStartPoint.copy(point);\n    this.dragIncrementalStartPoint.copy(point);\n    this.isBeingDraggedTranslation =\n      handle instanceof TranslationGroup ||\n      handle instanceof PickGroup ||\n      handle instanceof PickPlaneGroup;\n    this.isBeingDraggedRotation = handle instanceof RotationGroup;\n  };\n\n  /**\n   * @hidden\n   */\n  processDragEnd = (args: { handle: IHandle }) => {\n    const { handle } = args;\n    const { x: xSnap, y: ySnap, z: zSnap } = this.snapTranslation;\n    const snap = [xSnap, ySnap, zSnap];\n    if (\n      handle instanceof TranslationGroup ||\n      handle instanceof PickPlaneGroup ||\n      handle instanceof PickGroup\n    ) {\n      const xyz = this.object.position.toArray();\n      const floor = xyz.map(Math.floor);\n      const ceil = xyz.map(Math.ceil);\n      const snapFloor = xyz.map((p, index) => ceil[index] - p >= p - floor[index]);\n      const position = xyz.map((p, index) => {\n        if (!snap[index]) {\n          return p;\n        }\n        return snapFloor[index] ? floor[index] : ceil[index];\n      });\n      this.object.position.fromArray(position);\n    }\n    this.isBeingDraggedTranslation = false;\n    this.isBeingDraggedRotation = false;\n  };\n\n  /**\n   * Only takes effect if [[IControlsOptions.isDampingEnabled]] is true.\n   * @param dampingFactor - value between 0 and 1, acts like a weight on the controls\n   */\n  public setDampingFactor = (dampingFactor = 0) =>\n    (this.dampingFactor = THREE.Math.clamp(dampingFactor, 0, 1));\n\n  /**\n   * @hidden\n   */\n  processDrag = (args: { point: THREE.Vector3; handle: IHandle; dragRatio?: number }) => {\n    const { point, handle, dragRatio = 1 } = args;\n    const k = Math.exp(-this.dampingFactor * Math.abs(dragRatio ** 3));\n\n    if (handle instanceof TranslationGroup) {\n      this.deltaPosition.copy(point).sub(this.dragIncrementalStartPoint);\n      this.normalizedHandleParallelVectorCache\n        .copy(handle.parallel.normalize())\n        .applyQuaternion(this.quaternion);\n\n      const delta = this.deltaPosition.dot(this.normalizedHandleParallelVectorCache);\n      this.deltaPosition\n        .copy(this.normalizedHandleParallelVectorCache)\n        .multiplyScalar(this.isDampingEnabled ? k * delta : delta);\n\n      this.position.copy(this.getLimitedTranslation(this.deltaPosition));\n    } else if (handle instanceof PickGroup || handle instanceof PickPlaneGroup) {\n      this.deltaPosition\n        .copy(point)\n        .sub(this.dragIncrementalStartPoint)\n        .multiplyScalar(this.isDampingEnabled ? k : 1);\n\n      this.position.copy(this.getLimitedTranslation(this.deltaPosition));\n    } else {\n      this.touch1\n        .copy(this.dragIncrementalStartPoint)\n        .sub(this.objectWorldPosition)\n        .normalize();\n\n      this.touch2\n        .copy(point)\n        .sub(this.objectWorldPosition)\n        .normalize();\n\n      this.handleTargetQuaternion.setFromUnitVectors(this.touch1, this.touch2);\n      if (this.mode === ANCHOR_MODE.FIXED) {\n        this.detachHandleUpdateQuaternionAttach(handle, this.handleTargetQuaternion);\n      }\n    }\n\n    this.objectTargetQuaternion.premultiply(this.handleTargetQuaternion);\n    this.dragIncrementalStartPoint.copy(point);\n  };\n\n  private getLimitedTranslation = (translation: THREE.Vector3) => {\n    const position = translation.add(this.position);\n    if (!this.translationAnchor || !this.translationLimit) {\n      return position;\n    }\n    const { x: xLimit, y: yLimit, z: zLimit } = this.translationLimit;\n    const { x: xAnchor, y: yAnchor, z: zAnchor } = this.translationAnchor;\n    const { x, y, z } = position;\n    this.minTranslationCache.set(\n      xLimit ? xAnchor + xLimit[0] : x,\n      yLimit ? yAnchor + yLimit[0] : y,\n      zLimit ? zAnchor + zLimit[0] : z\n    );\n    this.maxTranslationCache.set(\n      xLimit ? xAnchor + xLimit[1] : x,\n      yLimit ? yAnchor + yLimit[1] : y,\n      zLimit ? zAnchor + zLimit[1] : z\n    );\n    return position.clamp(this.minTranslationCache, this.maxTranslationCache);\n  };\n\n  private detachObjectUpdatePositionAttach = (\n    parent: THREE.Object3D | null,\n    object: THREE.Object3D\n  ) => {\n    if (parent !== null && this.parent !== null && this.parent.parent !== null) {\n      const scene = this.parent.parent;\n      if (scene.type !== \"Scene\") {\n        throw new Error(\"freeform controls must be attached to the scene\");\n      }\n      scene.attach(object);\n      object.position.copy(this.objectTargetPosition);\n      parent.attach(object);\n    }\n  };\n\n  private detachHandleUpdateQuaternionAttach = (handle: IHandle, quaternion: THREE.Quaternion) => {\n    if (this.parent !== null && this.parent.parent) {\n      const scene = this.parent.parent;\n      if (scene.type !== \"Scene\") {\n        throw new Error(\"freeform controls must be attached to the scene\");\n      }\n      scene.attach(handle);\n      handle.applyQuaternion(quaternion);\n      this.attach(handle);\n    }\n  };\n\n  /**\n   * Applies supplied visibility to the supplied handle names.\n   * Individual handle's visibility can also be changed by modifying the `visibility`\n   * property on the handle directly.\n   * @param handleNames\n   * @param visibility\n   */\n  public showByNames = (\n    handleNames: Array<DEFAULT_HANDLE_GROUP_NAME | string>,\n    visibility = true\n  ) => {\n    const handleNamesMap: { [name: string]: IHandle | undefined } = {};\n    this.handles.forEach(handle => {\n      handleNamesMap[handle.name] = handle;\n    });\n    handleNames.map(handleName => {\n      const handle = handleNamesMap[handleName];\n      if (handle === undefined) {\n        throw new Error(`handle: ${handleName} not found`);\n      }\n      handle.visible = visibility;\n    });\n  };\n\n  /**\n   * Applies supplied visibility to all handles\n   * @param visibility\n   */\n  public showAll = (visibility = true) => {\n    this.handles.forEach(handle => {\n      handle.visible = visibility;\n    });\n  };\n\n  /**\n   * @hidden\n   */\n  public getInteractiveObjects(): THREE.Object3D[] {\n    const interactiveObjects: THREE.Object3D[] = [];\n    this.handles.forEach(handle => {\n      if (!handle.visible) {\n        return;\n      }\n      interactiveObjects.push(...handle.getInteractiveObjects());\n    });\n    return interactiveObjects;\n  }\n\n  /**\n   * @hidden\n   */\n  updateMatrixWorld = (force?: boolean) => {\n    this.object.updateMatrixWorld(force);\n\n    this.object.getWorldPosition(this.objectWorldPosition);\n    const parent = this.object.parent;\n    if (parent !== null) {\n      parent.matrixWorld.decompose(\n        this.objectParentWorldPosition,\n        this.objectParentWorldQuaternion,\n        this.objectParentWorldScale\n      );\n    }\n    this.objectParentWorldQuaternion.inverse();\n    this.objectTargetPosition.copy(this.position);\n    this.objectTargetQuaternion.premultiply(this.objectParentWorldQuaternion);\n\n    if (this.isBeingDraggedTranslation) {\n      this.detachObjectUpdatePositionAttach(parent, this.object);\n    } else if (this.isBeingDraggedRotation) {\n      this.object.quaternion.copy(this.objectTargetQuaternion);\n      this.detachObjectUpdatePositionAttach(parent, this.object);\n    } else {\n      this.position.copy(this.objectWorldPosition);\n    }\n\n    this.object.getWorldQuaternion(this.objectTargetQuaternion);\n    if (this.mode === ANCHOR_MODE.INHERIT && !this.isBeingDraggedTranslation) {\n      this.quaternion.copy(this.initialSelfQuaternion).premultiply(this.objectTargetQuaternion);\n    }\n\n    super.updateMatrixWorld(force);\n  };\n}\n","(\n  /**\n   * Interface for event subscription.\n   *\n   * @example\n   * var NanoEvents = require('nanoevents')\n   *\n   * class Ticker {\n   *   constructor() {\n   *     this.emitter = new NanoEvents()\n   *   }\n   *   on() {\n   *     return this.emitter.on.apply(this.events, arguments)\n   *   }\n   *   tick() {\n   *     this.emitter.emit('tick')\n   *   }\n   * }\n   *\n   * @alias NanoEvents\n   * @class\n   */\n  module.exports = function NanoEvents () {\n    /**\n     * Event names in keys and arrays with listeners in values.\n     * @type {object}\n     *\n     * @example\n     * Object.keys(ee.events)\n     *\n     * @alias NanoEvents#events\n     */\n    this.events = { }\n  }\n).prototype = {\n\n  /**\n   * Calls each of the listeners registered for a given event.\n   *\n   * @param {string} event The event name.\n   * @param {...*} arguments The arguments for listeners.\n   *\n   * @return {undefined}\n   *\n   * @example\n   * ee.emit('tick', tickType, tickDuration)\n   *\n   * @alias NanoEvents#emit\n   * @method\n   */\n  emit: function emit (event) {\n    var args = [].slice.call(arguments, 1)\n    // Array.prototype.call() returns empty array if context is not array-like\n    ;[].slice.call(this.events[event] || []).filter(function (i) {\n      i.apply(null, args)\n    })\n  },\n\n  /**\n   * Add a listener for a given event.\n   *\n   * @param {string} event The event name.\n   * @param {function} cb The listener function.\n   *\n   * @return {function} Unbind listener from event.\n   *\n   * @example\n   * const unbind = ee.on('tick', (tickType, tickDuration) => {\n   *   count += 1\n   * })\n   *\n   * disable () {\n   *   unbind()\n   * }\n   *\n   * @alias NanoEvents#on\n   * @method\n   */\n  on: function on (event, cb) {\n    if (process.env.NODE_ENV !== 'production' && typeof cb !== 'function') {\n      throw new Error('Listener must be a function')\n    }\n\n    (this.events[event] = this.events[event] || []).push(cb)\n\n    return function () {\n      this.events[event] = this.events[event].filter(function (i) {\n        return i !== cb\n      })\n    }.bind(this)\n  }\n}\n","/**\n * Removes all listeners.\n *\n * @param {NanoEvents} emitter NanoEvents instance.\n *\n * @returns {undefined}\n *\n * @example\n * unbindAll(emitter)\n */\nfunction unbindAll (emitter) {\n  emitter.events = { }\n}\n\nmodule.exports = unbindAll\n","import * as THREE from \"three\";\nimport NanoEvents from \"nanoevents\";\nimport unbindAllEvents from \"nanoevents/unbind-all\";\nimport { EVENTS } from \"./raycaster\";\nimport { IHandle } from \"../controls/handles\";\n\nexport const emitter = new NanoEvents<\n  {\n    [event in EVENTS]: {\n      point: THREE.Vector3;\n      handle: IHandle | null;\n      dragRatio?: number;\n    };\n  }\n>();\nexport const unbindAll = () => unbindAllEvents(emitter);\n","export const getPointFromEvent = (event: MouseEvent | TouchEvent) => {\n  let clientX: number = 0;\n  let clientY: number = 0;\n  if (event instanceof MouseEvent) {\n    clientX = event.clientX;\n    clientY = event.clientY;\n  } else if (event instanceof TouchEvent) {\n    if (event.touches.length === 0) {\n      return null;\n    }\n    clientX = event.touches[0].clientX;\n    clientY = event.touches[0].clientY;\n  }\n  return { clientX, clientY };\n};\n\nexport const addEventListener = (\n  element: HTMLElement,\n  eventNames: Array<\n    \"mousedown\" | \"touchstart\" | \"mouseup\" | \"touchend\" | \"mousemove\" | \"touchmove\"\n  >,\n  callback: (event: MouseEvent | TouchEvent) => void,\n  options: { passive?: boolean; capture?: boolean } | boolean = false\n) => {\n  eventNames.forEach(name => {\n    element.addEventListener(name, callback, options);\n  });\n};\n\nexport const removeEventListener = (\n  element: HTMLElement,\n  eventNames: Array<\n    \"mousedown\" | \"touchstart\" | \"mouseup\" | \"touchend\" | \"mousemove\" | \"touchmove\"\n  >,\n  callback: (event: MouseEvent | TouchEvent) => void,\n  options: { capture?: boolean } | boolean = false\n) => {\n  eventNames.forEach(name => {\n    element.removeEventListener(name, callback, options);\n  });\n};\n","import * as THREE from \"three\";\nimport { emitter } from \"./emmiter\";\nimport Controls from \"../controls\";\nimport PickPlane from \"../controls/handles/pick-plane\";\nimport { PICK_PLANE_OPACITY } from \"./constants\";\nimport { IHandle, PickGroup, RotationGroup, TranslationGroup } from \"../controls/handles\";\nimport RotationEye from \"../controls/handles/rotation-eye\";\nimport { addEventListener, getPointFromEvent, removeEventListener } from \"./helper\";\nimport Line from \"../primitives/line\";\n\nexport enum EVENTS {\n  DRAG_START = \"DRAG_START\",\n  DRAG = \"DRAG\",\n  DRAG_STOP = \"DRAG_STOP\"\n}\n\n/**\n * @hidden\n * The Raycaster listens on the mouse and touch events globally and\n * dispatches DRAG_START, DRAG, and DRAG_STOP events.\n */\nexport default class Raycaster extends THREE.Raycaster {\n  private mouse = new THREE.Vector2();\n  private cameraPosition = new THREE.Vector3();\n  private activeHandle: IHandle | null = null;\n  private activePlane: THREE.Plane | null = null;\n  private point = new THREE.Vector3();\n  private normal = new THREE.Vector3();\n  private visibleHandles: THREE.Object3D[] = [];\n  private visibleControls: THREE.Object3D[] = [];\n  private helperPlane: THREE.PlaneHelper | null = null;\n  private controlsWorldQuaternion = new THREE.Quaternion();\n  private clientDiagonalLength = 1;\n  private previousScreenPoint = new THREE.Vector2();\n  private currentScreenPoint = new THREE.Vector2();\n  private isActivePlaneFlipped = false;\n  private readonly highlightAxisLine: Line;\n\n  constructor(\n    public camera: THREE.Camera,\n    private domElement: HTMLElement,\n    private controls: { [id: string]: Controls }\n  ) {\n    super();\n    this.highlightAxisLine = this.createAxisLine();\n    /**\n     * mousedown and touchstart are used instead of pointerdown because\n     * pointermove seems to stop firing after some a few events in chrome mobile\n     * this could be because of some capture/passive setting but couldn't find\n     * anything useful. using touch(*) events works.\n     */\n    addEventListener(this.domElement, [\"mousedown\", \"touchstart\"], this.pointerDownListener, {\n      passive: false,\n      capture: true\n    });\n    addEventListener(this.domElement, [\"mouseup\", \"touchend\"], this.pointerUpListener, {\n      passive: false,\n      capture: true\n    });\n  }\n\n  private createAxisLine = () => {\n    const geometry = new THREE.Geometry();\n    geometry.vertices.push(new THREE.Vector3(0, 0, -100));\n    geometry.vertices.push(new THREE.Vector3(0, 0, 100));\n    return new Line(\"white\", geometry);\n  };\n\n  private pointerDownListener = (event: MouseEvent | TouchEvent) => {\n    const point = getPointFromEvent(event);\n    // touches can be empty\n    if (!point) {\n      return;\n    }\n    const { clientX, clientY } = point;\n    this.setRayDirection(clientX, clientY);\n\n    // useful for calculating dragRatio (used in dampingFactor calculation)\n    this.clientDiagonalLength = Math.sqrt(\n      (event.target as HTMLElement).clientWidth ** 2 +\n        (event.target as HTMLElement).clientHeight ** 2\n    );\n    this.previousScreenPoint.set(clientX, clientY);\n\n    const interactiveObjects: THREE.Object3D[] = [];\n    Object.values(this.controls).map(controls => {\n      interactiveObjects.push(...controls.getInteractiveObjects());\n    });\n    this.activeHandle = this.resolveHandleGroup(this.intersectObjects(interactiveObjects, true)[0]);\n\n    if (this.activeHandle?.parent) {\n      const controls = this.activeHandle.parent as Controls;\n\n      // hiding other controls and handles instances if asked\n      if (controls.hideOtherControlsInstancesOnDrag) {\n        Object.values(this.controls).forEach(x => {\n          if (x.visible) {\n            this.visibleControls.push(x);\n          }\n          x.visible = false;\n        });\n        controls.visible = true;\n      }\n\n      if (controls.hideOtherHandlesOnDrag) {\n        controls.children.map(handle => {\n          if (handle.visible) {\n            this.visibleHandles.push(handle);\n          }\n          handle.visible = false;\n        });\n        this.activeHandle.visible = true;\n      }\n\n      if (this.activeHandle instanceof PickPlane) {\n        this.setPickPlaneOpacity(PICK_PLANE_OPACITY.ACTIVE);\n      }\n\n      /**\n       * creating the activePlane - the plane on which intersection actions\n       * take place. mouse movements are translated to points on the activePlane\n       */\n      this.activePlane = new THREE.Plane();\n      const eyePlaneNormal = this.getEyePlaneNormal(this.activeHandle);\n      controls.getWorldQuaternion(this.controlsWorldQuaternion);\n      this.normal.copy(\n        this.activeHandle instanceof PickGroup ? eyePlaneNormal : this.activeHandle.up\n      );\n      if (!(this.activeHandle instanceof RotationEye || this.activeHandle instanceof PickGroup)) {\n        this.normal.applyQuaternion(this.controlsWorldQuaternion);\n      }\n      /*\n        if the angle between the eye-normal and the normal to the activePlane is\n        too small, a small mouse movement makes a large projection on the activePlane,\n        causing the object to jump big distances. To avoid this, the activePlane\n        is flipped by 90 degrees about the parallel vector of the handle.\n        This problem only requires mitigation in the TranslationGroup handle case.\n       */\n      if (this.activeHandle instanceof TranslationGroup) {\n        const dot = eyePlaneNormal.dot(this.normal) / eyePlaneNormal.length();\n        // arccos(0.25) ~= 75 degrees\n        // this is the threshold to make the plane normal flip\n        this.isActivePlaneFlipped = Math.abs(dot) < 0.25;\n        if (this.isActivePlaneFlipped) {\n          this.isActivePlaneFlipped = true;\n          this.normal.applyAxisAngle(this.activeHandle.parallel, Math.PI / 2);\n        }\n      }\n      if (this.activeHandle instanceof TranslationGroup) {\n        this.activePlane.setFromNormalAndCoplanarPoint(this.normal, this.activeHandle.position);\n      } else {\n        this.activePlane.setFromNormalAndCoplanarPoint(this.normal, controls.position);\n      }\n\n      // find initial intersection\n      const initialIntersectionPoint = new THREE.Vector3();\n      if (this.activeHandle instanceof PickGroup) {\n        this.activeHandle.getWorldPosition(initialIntersectionPoint);\n      } else {\n        this.ray.intersectPlane(this.activePlane, initialIntersectionPoint);\n      }\n\n      // activate the helper plane if asked\n      // available only for TranslationGroup and RotationGroup\n      // (except RotationEye - plane of rotation is obvious)\n      const scene = controls.parent as THREE.Scene;\n      if (\n        controls.showHelperPlane &&\n        (this.activeHandle instanceof TranslationGroup ||\n          this.activeHandle instanceof RotationGroup) &&\n        !(this.activeHandle instanceof RotationEye)\n      ) {\n        this.helperPlane = new THREE.PlaneHelper(this.activePlane, 1);\n        scene.add(this.helperPlane);\n      }\n\n      /**\n       * activate the highlightAxis if asked\n       * available only for TranslationGroup and RotationGroup\n       * (except RotationEye - plane of rotation is obvious)\n       */\n      if (\n        controls.highlightAxis &&\n        (this.activeHandle instanceof TranslationGroup ||\n          this.activeHandle instanceof RotationGroup) &&\n        !(this.activeHandle instanceof RotationEye)\n      ) {\n        this.activeHandle.getWorldPosition(this.highlightAxisLine.position);\n        const direction = this.highlightAxisLine.position.clone();\n        if (this.activeHandle instanceof TranslationGroup) {\n          direction.add(this.activeHandle.parallel);\n        } else {\n          direction.add(this.activeHandle.up);\n        }\n        this.highlightAxisLine.lookAt(direction);\n        scene.add(this.highlightAxisLine);\n      }\n\n      // switch event listeners and dispatch DRAG_START\n      removeEventListener(this.domElement, [\"mousedown\", \"touchstart\"], this.pointerDownListener, {\n        capture: true\n      });\n      emitter.emit(EVENTS.DRAG_START, {\n        point: initialIntersectionPoint,\n        handle: this.activeHandle\n      });\n      addEventListener(this.domElement, [\"mousemove\", \"touchmove\"], this.pointerMoveListener, {\n        passive: false,\n        capture: true\n      });\n    } else {\n      this.activePlane = null;\n    }\n  };\n\n  private getEyePlaneNormal = (object: THREE.Object3D) => {\n    this.cameraPosition.copy(this.camera.position);\n    return this.cameraPosition.sub(object.position);\n  };\n\n  private setRayDirection = (clientX: number, clientY: number) => {\n    const rect = this.domElement.getBoundingClientRect();\n    const { clientHeight, clientWidth } = this.domElement;\n    this.mouse.x = ((clientX - rect.left) / clientWidth) * 2 - 1;\n    this.mouse.y = -((clientY - rect.top) / clientHeight) * 2 + 1;\n    this.setFromCamera(this.mouse, this.camera);\n  };\n\n  private pointerMoveListener = (event: MouseEvent | TouchEvent) => {\n    if (this.activeHandle === null || this.activePlane === null) {\n      return;\n    }\n    const point = getPointFromEvent(event);\n    if (!point) {\n      return;\n    }\n    const { clientX, clientY } = point;\n\n    this.setRayDirection(clientX, clientY);\n    this.ray.intersectPlane(this.activePlane, this.point);\n\n    this.currentScreenPoint.set(clientX, clientY);\n    const distance = this.currentScreenPoint.distanceTo(this.previousScreenPoint);\n    const dragRatio = distance / (this.clientDiagonalLength || 1);\n\n    emitter.emit(EVENTS.DRAG, {\n      point: this.point,\n      handle: this.activeHandle,\n      dragRatio\n    });\n\n    this.previousScreenPoint.set(clientX, clientY);\n  };\n\n  private pointerUpListener = () => {\n    removeEventListener(this.domElement, [\"mousemove\", \"touchmove\"], this.pointerMoveListener, {\n      capture: true\n    });\n    addEventListener(this.domElement, [\"mousedown\", \"touchstart\"], this.pointerDownListener, {\n      passive: false,\n      capture: true\n    });\n    emitter.emit(EVENTS.DRAG_STOP, { point: this.point, handle: this.activeHandle });\n\n    if (\n      this.activeHandle?.parent &&\n      (this.activeHandle.parent as Controls).hideOtherControlsInstancesOnDrag\n    ) {\n      this.visibleControls.forEach(controls => {\n        controls.visible = true;\n      });\n      this.visibleControls = [];\n    }\n\n    if (\n      this.activeHandle?.parent &&\n      (this.activeHandle.parent as Controls).hideOtherHandlesOnDrag\n    ) {\n      this.visibleHandles.forEach(handle => {\n        handle.visible = true;\n      });\n      this.visibleHandles = [];\n    }\n\n    if (this.activeHandle instanceof PickPlane) {\n      this.setPickPlaneOpacity(PICK_PLANE_OPACITY.INACTIVE);\n    }\n\n    const scene = this.activeHandle?.parent?.parent;\n    if (scene) {\n      if (this.helperPlane) {\n        scene.remove(this.helperPlane);\n      }\n      scene.remove(this.highlightAxisLine);\n    }\n    this.activeHandle = null;\n    this.activePlane = null;\n  };\n\n  private setPickPlaneOpacity(opacity: number) {\n    if (!(this.activeHandle instanceof PickPlane)) {\n      return;\n    }\n    const material = this.activeHandle.plane.material;\n    if (Array.isArray(material)) {\n      material.map(m => {\n        m.opacity = opacity;\n        m.needsUpdate = true;\n      });\n    } else {\n      material.opacity = opacity;\n      material.needsUpdate = true;\n    }\n  }\n\n  private resolveHandleGroup = (intersectedObject: THREE.Intersection | undefined) => {\n    if (intersectedObject === undefined) {\n      return null;\n    }\n\n    return intersectedObject.object.parent as IHandle;\n  };\n\n  public destroy = () => {\n    this.activePlane = null;\n    this.activeHandle = null;\n    removeEventListener(this.domElement, [\"mousedown\", \"touchstart\"], this.pointerDownListener, {\n      capture: true\n    });\n    removeEventListener(this.domElement, [\"mousemove\", \"touchmove\"], this.pointerMoveListener, {\n      capture: true\n    });\n    removeEventListener(this.domElement, [\"mouseup\", \"touchend\"], this.pointerUpListener, {\n      capture: true\n    });\n  };\n}\n","import * as THREE from \"three\";\nimport Controls, { IControlsOptions } from \"./controls\";\nimport Raycaster, { EVENTS } from \"./utils/raycaster\";\nimport { emitter, unbindAll } from \"./utils/emmiter\";\nimport { DEFAULT_HANDLE_GROUP_NAME } from \"./controls/handles\";\n\n/**\n * The ControlsManager provides helper functions to create Controls instances\n * and link them up with a Raycaster instance (reused across multiple Controls\n * instances).\n * @noInheritDoc\n */\nexport default class ControlsManager extends THREE.Object3D {\n  private objects: { [id: number]: THREE.Object3D } = {};\n  private controls: { [id: number]: Controls } = {};\n  private eventListeners: {\n    [event in EVENTS]: Array<\n      (object: THREE.Object3D | null, handleName: DEFAULT_HANDLE_GROUP_NAME | string) => void\n    >;\n  } = {\n    [EVENTS.DRAG_START]: [],\n    [EVENTS.DRAG]: [],\n    [EVENTS.DRAG_STOP]: []\n  };\n  private rayCaster: Raycaster;\n\n  /**\n   * @param camera - the THREE.Camera instance used in the scene\n   * @param domElement - the dom element on which THREE.js renderer is attached,\n   * generally available as `renderer.domElement`\n   */\n  constructor(private camera: THREE.Camera, private domElement: HTMLElement) {\n    super();\n    this.rayCaster = new Raycaster(this.camera, this.domElement, this.controls);\n    this.listenToEvents();\n  }\n\n  private listenToEvents = () => {\n    emitter.on(EVENTS.DRAG_START, ({ point, handle }) => {\n      if (handle === null) {\n        return;\n      }\n      const controls = handle.parent as Controls | null;\n      if (controls === null) {\n        return;\n      }\n      controls.processDragStart({ point, handle });\n      this.eventListeners[EVENTS.DRAG_START].map(callback => {\n        callback(controls.object, handle.name);\n      });\n    });\n\n    emitter.on(EVENTS.DRAG, ({ point, handle, dragRatio }) => {\n      if (handle === null) {\n        return;\n      }\n      const controls = handle.parent as Controls | null;\n      if (controls === null) {\n        return;\n      }\n      controls.processDrag({ point, handle, dragRatio });\n      this.eventListeners[EVENTS.DRAG].map(callback => {\n        callback(controls.object, handle.name);\n      });\n    });\n\n    emitter.on(EVENTS.DRAG_STOP, ({ handle }) => {\n      if (handle === null) {\n        return;\n      }\n      const controls = handle.parent as Controls | null;\n      if (controls === null) {\n        return;\n      }\n      controls.processDragEnd({ handle });\n      this.eventListeners[EVENTS.DRAG_STOP].map(callback => {\n        callback(controls.object, handle.name);\n      });\n    });\n  };\n\n  /**\n   * Creates a Controls instance and attaches it to the provided THREE.js object\n   *\n   * @param object - the object provided by the user\n   * @param options\n   */\n  public anchor = (object: THREE.Object3D, options?: IControlsOptions) => {\n    const controls = this.addControls(object, options);\n    this.objects[object.id] = object;\n    return controls;\n  };\n\n  /**\n   * Detaches the Controls instance from the provided THREE.js object\n   *\n   * @param object - the object provided by the user\n   * @param controls - the controls instance anchored on the object\n   */\n  public detach = (object: THREE.Object3D, controls: Controls) => {\n    if (!this.objects.hasOwnProperty(object.id)) {\n      throw new Error(\"object should be attached first\");\n    }\n    this.remove(controls);\n    this.dispose(controls);\n\n    delete this.objects[object.id];\n    delete this.controls[controls.id];\n  };\n\n  private addControls = (object: THREE.Object3D, options?: IControlsOptions) => {\n    const controls = new Controls(object, this.camera, options);\n    this.controls[controls.id] = controls;\n    this.add(controls);\n    return controls;\n  };\n\n  /**\n   * Adds an event listener. Note that there is another method `addEventListener`\n   * on THREE.Object3D from which this class extends but that is specific to the\n   * internals of THREE.js, but not this library\n   * @param event\n   * @param callback - by default the second argument is the default group name\n   * for the Handle involved; for a custom handle, it is the `name` property\n   * set on the handle\n   */\n  public listen = (\n    event: EVENTS,\n    callback: (\n      object: THREE.Object3D | null,\n      handleName: DEFAULT_HANDLE_GROUP_NAME | string\n    ) => void\n  ): void => {\n    this.eventListeners[event].push(callback);\n  };\n\n  /**\n   * Removes the event listener.\n   * @param event\n   * @param callback\n   */\n  public removeListen = (\n    event: EVENTS,\n    callback: (\n      object: THREE.Object3D | null,\n      handleName: DEFAULT_HANDLE_GROUP_NAME | string\n    ) => void\n  ): void => {\n    const index = this.eventListeners[event].findIndex(x => x === callback);\n    if (index !== -1) {\n      this.eventListeners[event].splice(index, 1);\n    }\n  };\n\n  private dispose = (object: THREE.Object3D) => {\n    if (object instanceof THREE.Mesh) {\n      object.geometry.dispose();\n      if (Array.isArray(object.material)) {\n        object.material.map(material => material.dispose());\n      } else {\n        object.material.dispose();\n      }\n    }\n    while (object.children.length > 0) {\n      object.children.map(child => {\n        this.dispose(child);\n        object.remove(child);\n      });\n    }\n  };\n\n  /**\n   * Destroys all Controls instances and removes all event listeners\n   */\n  public destroy = () => {\n    unbindAll();\n\n    const scene = this.parent;\n    if (scene !== null) {\n      scene.remove(this);\n    }\n    this.dispose(this);\n    Object.values(this.controls).map(control => {\n      this.dispose(control);\n    });\n\n    this.rayCaster.destroy();\n    this.objects = {};\n    this.controls = {};\n    this.eventListeners = {\n      [EVENTS.DRAG_START]: [],\n      [EVENTS.DRAG]: [],\n      [EVENTS.DRAG_STOP]: []\n    };\n  };\n}\n"],"names":["THREE.ConeGeometry","THREE.MeshBasicMaterial","THREE.Mesh","THREE.LineLoop","DEFAULT_HANDLE_GROUP_NAME","THREE.Group","THREE.Vector3","THREE.Geometry","THREE.OctahedronBufferGeometry","THREE.DoubleSide","THREE.PlaneGeometry","THREE.Quaternion","ANCHOR_MODE","THREE.Math","NanoEvents","unbindAll","unbindAllEvents","EVENTS","THREE.Vector2","THREE.Plane","THREE.PlaneHelper","THREE.Raycaster","THREE.Object3D"],"mappings":"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"}